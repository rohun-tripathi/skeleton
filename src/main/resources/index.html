<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css"/>
    <script data-require="jquery@*" data-semver="3.1.1"
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <style>
        #container {
            border: 1px solid brown;
        }

        H1 {
            float: left;
        }

        .button {
            background-color: #55A;
            border: 1px solid #229;
            width: 100px;
            float: right;
            font-size: 2em;
            color: white;
            text-align: center;
        }

        #receiptList {
            border: 1px solid green;
            clear: both;
        }

        .receipt {
            background-color: #eee;
            margin-bottom: 5px;
        }

    </style>
    <script>
        // This is the idiomatic way to ensure that JQuery does not
        // execute until the page has loaded
        const api = "http://ec2-52-91-37-123.compute-1.amazonaws.com:8080"; // <- do not need a root api URL if this page is served directly by the API

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        $(document).ready(function () {

            function refresh_receipt(receipts) {

                $("#receiptList").innerHTML = "";

                for (var i = 0; i < receipts.length; i++) {
                    var receipt = receipts[i];
                    $(`<div class="receipt">
                    Name : <span class="merchant">${receipt.merchantName}</span> <br>
                    Amount : <span class="amount">${receipt.value}</span> <br>
                    Tags : <span class="tags">${receipt.value}</span> <br>
                    Time : ${receipt.value}
                    </div>`)
                        .appendTo($("#receiptList"));
                }
            }

            function main() {
                var millisecondsToWait = 500;
                setTimeout(function() {
                    console.log("waited")
                }, millisecondsToWait);

                $.ajax({
                    url: api + "/receipts",
                    success: function (data) {
                        refresh_receipt(data);
                    }
                })
            }

            main();

            p_test = document.getElementById("lets_do_this");
            p_test.style.display = "none";

            plus_button = document.getElementById("plus_button");

            plus_button.addEventListener("click", myFunction);

            function myFunction() {
                p_test.style.display = "initial";
            }

            call_test = document.getElementById("make_call");
            call_test.addEventListener("click", myFunction2);

            call_test = document.getElementById("cancel_call");
            call_test.addEventListener("click", cancel_function);

            function myFunction2() {
                $.ajax({
                    url: api + "/receipts",
                    type: "POST", dataType: "text",
                    data: JSON.stringify({
                        merchant: document.getElementById("merchant").value,
                        amount: document.getElementById("amount").value
                    }),
                    contentType: "application/json",
                    async : false,
                    complete: main(),
                    timeout : 2000
                })
            }

            function cancel_function() {
                document.getElementById("merchant").value = "";
                document.getElementById("amount").value = "";
                p_test.style.display = "none"
            }
        });
    </script>
</head>

<body>
<DIV id="container">

    <div id="lets_do_this">
        <div>MerchantName : <input id="merchant"/></div><br>
        <div>Amount : <input id="amount" /></div>
        <div class="button" id="make_call">Save</div><br><br>
        <div class="button" id="cancel_call">Cancel</div><br><br><hr>
    </div>

    <h1>My receipts</h1>
    <div class="button" id="plus_button">+</div>
    <div id="receiptList">
    </div>
</DIV>
</body>

</html>
